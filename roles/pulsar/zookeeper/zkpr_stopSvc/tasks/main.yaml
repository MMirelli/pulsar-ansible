---
- name: Check if zookeeper server is already running
  stat:
    path: "{{ tgt_pulsar_inst_dir }}/bin/pulsar-zookeeper.pid"
  register: stat_result
  
- name: Stop zookeeper server if it is running
  shell: "{{ tgt_pulsar_inst_dir }}/bin/pulsar-daemon stop zookeeper"
  when: stat_result.stat.exists

- name: Wait until zookeeper listeneing port {{ zk_clnt_port }} is gone
  wait_for:
    host: "{{ private_ip }}"
    port: "{{ zk_clnt_port }}"
    state: stopped
    delay: 2
    timeout: 120

- name: Delete zookeeper process ID file
  file:
    path: "{{ tgt_pulsar_inst_dir }}/bin/pulsar-zookeeper.pid"
    state: absent
  when: stat_result.stat.exists